<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<title>لعبة الشطرنج - الجزء الأول</title>
<!-- استيراد مكتبات chessboard.js و chess.js -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessboardjs/dist/chessboard-1.0.0.min.css" />
<script src="https://cdn.jsdelivr.net/npm/chessboardjs/dist/chessboard-1.0.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chess.js/chess.js"></script>
<style>
  body { font-family: Arial, sans-serif; text-align: center; background-color: #f0f0f0; padding: 20px; }
  #board { width: 400px; margin: auto; }
  #message { margin-top: 20px; font-size: 18px; }
  #inputToken { margin-top: 10px; padding: 8px; width: 200px; font-size: 16px; }
  #submitToken { padding: 8px 16px; font-size: 16px; }
</style>
</head>
<body>

<h1>لعبة الشطرنج - الجزء الأول</h1>
<div id="board"></div>
<div id="message"></div>
<div id="tokenSection" style="display:none;">
  <p>أدخل الرمز بعد الفوز:</p>
  <input type="text" id="inputToken" placeholder="أدخل الرمز هنا" />
  <button id="submitToken">إرسال</button>
</div>

<script>
var board = null;
var game = new Chess();

function onDragStart(source, piece, position, orientation) {
  // عدم السماح بتحريك القطع إذا كانت اللعبة منتهية
  if (game.game_over()) return false;

  // السماح فقط بتحريك القطع التي تخص اللاعب الأبيض
  if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
      (game.turn() === 'b' && piece.search(/^w/) !== -1)) {
    return false;
  }
}

function onDrop(source, target) {
  var move = game.move({
    from: source,
    to: target,
    promotion: 'q' // دائمًا ترقية للوزير
  });

  if (move === null) return 'snapback';

  // التحقق من حالة الفوز (مات أو تعادل)
  if (game.in_checkmate()) {
    // عند الفوز، تظهر رسالة بالرمز
    showVictoryMessage();
  }
}

function showVictoryMessage() {
  // إظهار رسالة و الرمز
  document.getElementById('message').innerHTML = 'مبروك! لقد فزت. الرمز هو: <b>12345</b>';
  document.getElementById('tokenSection').style.display = 'block';
  // تعطيل اللعبة
  board.destroy();
}

var config = {
  position: 'start',
  draggable: true,
  onDragStart: onDragStart,
  onDrop: onDrop,
  orientation: 'white'
};
board = Chessboard('board', config);

// وظيفة التحقق من الرمز
document.getElementById('submitToken').onclick = function() {
  var enteredToken = document.getElementById('inputToken').value.trim();
  if (enteredToken === '12345') {
    // انتقل للصفحة الثانية
    window.location.href = 'second.html';
  } else {
    alert('رمز غير صحيح، حاول مرة أخرى.');
  }
};
</script>

</body>
</html>